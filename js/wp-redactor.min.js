/*! Redactor 0.0.1 wp-redactor.min.js 2016-05-22 5:33:26 PM */
var redactorHelper=new function(){this.shortcodes2Html=function(a){return null==a?"":a.replace(/\[(redact[^\]]*)\]([^\[]*)\[\/redact\]/g,function(a,b,c){return"<span class='allowed' title='"+b.replace(/"|'/g,"|")+"'>"+c+"</span>"})},this.html2Shortcodes=function(a){return null==a?"":a.replace(/<span class=\"allowed\" title=\"([^\"]+)\">([^<]*)<\/span>/g,function(a,b,c){return"["+b.replace(/\|/g,"'")+"]"+c+"[/redact]"})},this.replaceNodeWithFirstChild=function(a){if(null==a)return"";var b=a.parentNode,c=a.firstChild;b.replaceChild(c,a)}};!function(a){function b(b){function c(){q=[{id:"id",name:"Rule #",field:"id",width:75},{id:"str_username",name:"Added By",field:"str_username",width:100},{id:"rx_redaction",name:"Rule",field:"rx_redaction",width:500,editor:Slick.Editors.Text},{id:"str_groups",name:"Permissions",field:"str_groups",width:475,editor:window.RuleGridPermissionsEditor},{id:"dt_added",name:"Added",field:"dt_added",width:150}],r=new Slick.RuleGridOptionsColumn({cssClass:"redactor_optionsColumn"}),s={editable:!0,enableAddRow:!0,enableCellNaviagation:!1,enableColumnReorder:!1,autoEdit:!1}}function d(c,d){var e=d.item;e.str_username=x,a.ajax({url:b+"?action=addRules",global:!1,cache:!0,type:"POST",data:e,dataType:"json",success:function(a,b,c){p.addItem(a)},error:function(a,b,c){}})}function e(c,d){var e=d.item;console.log(e),a.ajax({url:b+"?action=updateRules",global:!1,cache:!0,type:"POST",data:e,dataType:"json",success:function(a,b,c){0!=a?e=a:console.log("Error")},error:function(a,b,c){},complete:function(a,b){o.invalidateRow(d.row),u[d.row]=e,o.render()}})}function f(a,b){console.log(b),o.updateRowCount(),o.render()}function g(a,b){console.log(b),o.invalidateRows(b.rows),o.render()}function h(){p=new Slick.Data.DataView,o=new Slick.Grid(z,p,w,s),o.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!1})),o.registerPlugin(r),o.onAddNewRow.subscribe(d),o.onCellChange.subscribe(e),p.onRowCountChanged.subscribe(f),p.onRowsChanged.subscribe(g)}function i(){a.ajax({url:b,global:!1,cache:!0,type:"GET",data:{action:"get_username_date"},dataType:"json",success:function(a,b,c){x=a.name},error:function(a,b,c){x="Error!"}})}function j(c){var d,e=p.getItem(c);d=_.isObject(e)&&e.id?[e.id]:[null],console.log(d),a.ajax({url:b+"?action=deleteRules",global:!1,cache:!0,type:"POST",data:{id:d},dataType:"json",success:function(a,b,c){0!=a&&p.deleteItem(e.id)},error:function(a,b,c){}})}function k(){a.ajax({url:b,global:!1,cache:!0,type:"GET",data:{action:"get_roles"},dataType:"json",success:function(a,b,c){y=a},error:function(a,b,c){y=[]}})}function l(){a.ajax({url:b+"?action=getRules",global:!1,cache:!0,type:"GET",data:{},dataType:"json",success:function(a,b,c){p.setItems(a.results||v)},error:function(a,b,c){u=v}})}function m(a){z=a,c(),w.push(r.getColumnDefinition()),w=w.concat(q),h(),i(),k(),l()}function n(){return y}var o,p,q,r,s,t=this,u=[],v=[{rx_redaction:"Error loading redaction rules"}],w=[],x="",y=[],z="";t.initGrid=m,t.deleteRule=j,t.getRoleList=n}a.extend(!0,window,{DataSync_RedactionRuleGrid:b})}(jQuery),function(a){function b(b){function c(a){g=a}function d(){}function e(){return{id:i.columnId,name:"Options",toolTip:i.toolTip,field:"sel",width:i.width,resizable:!1,sortable:!1,cssClass:i.cssClass,formatter:f}}function f(a,b,c,d,e){if(e){var f="";return f+="<a class='redactor_button' onClick='RuleGrid.deleteRule("+a+");'>Delete</a>"}return null}var g,h=(new Slick.EventHandler,{columnId:"_rule_options",cssClass:null,toolTip:"Options Column",width:100}),i=a.extend(!0,{},h,b);a.extend(this,{init:c,destroy:d,getColumnDefinition:e})}a.extend(!0,window,{Slick:{RuleGridOptionsColumn:b}})}(jQuery),function(a){function b(b){var c,d,e,f=[],g=[],h=this,i=b.item;h.values=g,this.init=function(){d=a("body"),c=a("<div class='rg-permedit-container'></div>").appendTo(d),c.focus(),a.each(RuleGrid.getRoleList(),function(b,d){var e=a("<label>"+d+"</label><br/>"),g=a("<input type='checkbox' value='"+d+"' name='cb"+b+"' />");f.push({role:d,checkbox:g}),g.appendTo(c),e.appendTo(c)}),c.dialog({dialogClass:"wp-dialog",title:"Set Permissions",modal:!0,autoOpen:!1,closeOnEscape:!0,buttons:{Save:function(){i.str_groups=h.serializeValue(),a(this).dialog("close"),b.commitChanges()},Cancel:function(){a(this).dialog("close"),b.cancelChanges()}}})},this.destroy=function(){c.dialog("close"),c.remove()},this.focus=function(){c.dialog("open")},this.isValueChanged=function(){return e!=this.serializeValue()},this.serializeValue=function(){return results=[],_.each(f,function(a){a.checkbox[0].checked&&results.push(a.role)}),results.join(",")},this.loadValue=function(b){e=b.str_groups,a.each(f,function(a,b){b.checkbox[0].checked=!1}),_.isString(b.str_groups)&&""!=b.str_groups&&(v=b.str_groups.split(","),_.each(v,function(a){_.each(f,function(b){b.role==a&&(b.checkbox[0].checked=!0)})}))},this.applyValue=function(a,b){a.str_groups=b},this.validate=function(){return{valid:!0,msg:null}},this.hide=function(){c.dialog("close")},this.show=function(){c.dialog("open")},this.position=function(a){},this.init()}a.extend(!0,window,{RuleGridPermissionsEditor:b})}(jQuery),jQuery(document).ready(function(){jQuery("#autorule-table").length&&(window.RuleGrid=new DataSync_RedactionRuleGrid(ajaxurl),RuleGrid.initGrid("#autorule-table"))}),function(a){function b(){function b(){}function c(a,b){for(var c=a;b>=c;c++)if(void 0==k[c]||null==k[c])return!1;return!0}function d(){for(var a in k)delete k[a];k.length=0}function e(b,c){for(0>b&&(b=0);void 0!==k[b]&&c>b;)b++;for(;void 0!==k[c]&&c>b;)c--;if(void 0===k[b]){var d=c-b+1;if(j>d){var e=Math.round((j-d)/2);if(b-=e,c+=e,0>b&&(c-=b,b=0),void 0!==k[b])for(;void 0!==k[b];)b++,c++;else if(void 0!==k[c])for(;void 0!==k[c]&&b>0;)b--,c--}for(;void 0!==k[b]&&c>b;)b++;for(;void 0!==k[c]&&c>b;)c--;null!==o&&clearTimeout(o),o=setTimeout(function(){p++;for(var d=b;c>=d;d++)k[d]||(k[d]=null);q.notify({from:b,to:c}),a.ajax({url:ajaxurl,global:!1,cache:!0,type:"GET",data:{offset:b,limit:c,action:"getRules",sortColumn:"",sortDirection:""},dataType:"json",success:function(a,b,c){p>0&&p--,f(a,b,c)},error:function(a,d,e){p>0&&p--,"abort"!==d&&r.notify({from:b,to:c,pendingRequests:p,textStatus:d,errorThrown:e})}})},100)}}function f(a){var b=a.offset,c=b+a.results.length;k.length=a.total;for(var d=0;d<a.results.length;d++){var e=a.results[d];k[b+d]=e,k[b+d].index=b+d}o=null,console.log(a.results),s.notify({from:b,to:c})}function g(a,b){for(var c=a;b>=c;c++)delete k[c];e(a,b)}function h(a,b){m=a,n=b,d()}function i(a){l=a,d()}var j=100,k={length:0},l="",m=null,n=1,o=null,p=0,q=new Slick.Event,r=new Slick.Event,s=new Slick.Event;return b(),{data:k,clear:d,isDataLoaded:c,ensureData:e,reloadData:g,setSort:h,setSearch:i,onDataLoading:q,onDataLoaded:s}}a.extend(!0,window,{Slick:{Data:{RemoteModel:b}}})}(jQuery),jQuery(document).ready(function(){jQuery(".redacted, .allowed").tooltipster({position:"top-right"})});